---
import Layout from '../layouts/Layout.astro';
import Footer from '../components/Footer.astro';
import FileUpload from '../components/FileUpload.astro';
import ResultsTable from '../components/ResultsTable.astro';
import LabResultsDebug from '../components/LabResultsDebug.astro';

export const prerender = false;
---

<Layout 
  title="Track Your Labs - Turn lab PDFs into insights"
  description="Upload your lab results and instantly see trends, track changes over time, and understand your health data. No spreadsheets, no typing. HIPAA-compliant and secure."
>

  <main class="flex-1">
    <!-- Hero Section -->
    <div class="min-h-screen bg-base-100 pt-16">
      <div class="text-center">
        <div class="max-w-5xl mx-auto px-4">
          <h1 class="text-5xl font-bold mb-4">Track Your Labs</h1>
          <p class="text-xl text-gray-600 leading-relaxed max-w-3xl mx-auto mb-12">
            Turn lab PDFs into insights. Automatically.
          </p>
          
          <FileUpload />
          
          <!-- Marketing Copy Section -->
          <div id="marketing-section" class="marketing-section">
            <div class="vertical-separator"></div>
            
            <div class="marketing-content">
              <h2 class="marketing-title">Convert Lab Test PDFs to Structured Data</h2>
              
              <p class="marketing-description">
                Stop manually transcribing lab results into spreadsheets. Track Your Labs automatically 
                extracts data from your medical test reports, normalizes test names across different labs, and 
                organizes everything into clean, analyzable formats. Use our free tool to process PDFs from 
                any lab—Quest, LabCorp, hospital systems, or independent facilities—and see what your 
                health data can tell you.
              </p>
              
              <div class="benefits-section">
                <h3 class="benefits-title">Key Benefits:</h3>
                
                <ul class="benefits-list">
                  <li class="benefit-item">
                    <svg class="benefit-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                    </svg>
                    <span><strong>Free PDF Processing</strong> - Upload up to 50 lab reports at once, anonymous and HIPAA-compliant</span>
                  </li>
                  <li class="benefit-item">
                    <svg class="benefit-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a1.5 1.5 0 00-1.006-1.006L15.75 7.5l1.035-.259a1.5 1.5 0 001.006-1.006L18 5.25l.259 1.035a1.5 1.5 0 001.006 1.006L20.25 7.5l-1.035.259a1.5 1.5 0 00-1.006 1.006zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
                    </svg>
                    <span><strong>Smart Test Normalization</strong> - Automatically standardizes test names across different lab formats</span>
                  </li>
                  <li class="benefit-item">
                    <svg class="benefit-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
                    </svg>
                    <span><strong>Instant Trend Visualization</strong> - See patterns in your health data with intelligent charts</span>
                  </li>
                  <li class="benefit-item">
                    <svg class="benefit-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                    </svg>
                    <span><strong>Export-Ready Data</strong> - Download clean CSV files for your records or further analysis</span>
                  </li>
                  <li class="benefit-item">
                    <svg class="benefit-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" />
                    </svg>
                    <span><strong>Zero Data Retention</strong> - Process anonymously with complete privacy protection</span>
                  </li>
                </ul>
              </div>
              
              <div class="cta-section">
                <p class="cta-text">
                  <strong>Ready for More Insights?</strong> Create a free account to store your lab history, connect data from 
                  wearables and nutrition apps, and get personalized insights on what's working in your health journey.
                </p>
              </div>
            </div>
          </div>
          
          <!-- Results Table -->
          <ResultsTable />
        </div>
      </div>
    </div>
  </main>

  <Footer />
</Layout>

<style>
  .marketing-section {
    margin-top: 4rem;
    padding: 0 1rem;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
    transition: opacity 0.3s ease, max-height 0.3s ease;
  }

  .vertical-separator {
    width: 1px;
    height: 150px;
    background: linear-gradient(to bottom, #e5e7eb, #e5e7eb 50%, transparent);
    margin: 0 auto 3rem;
  }

  .marketing-content {
    text-align: left;
    color: #374151;
  }

  .marketing-title {
    font-size: 1.875rem;
    font-weight: 700;
    color: #111827;
    margin-bottom: 1.5rem;
    line-height: 1.3;
  }

  .marketing-description {
    font-size: 1.125rem;
    line-height: 1.75;
    color: #4b5563;
    margin-bottom: 2.5rem;
  }

  .benefits-section {
    margin-bottom: 2.5rem;
  }

  .benefits-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #111827;
    margin-bottom: 1.25rem;
  }

  .benefits-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .benefit-item {
    margin-bottom: 1.25rem;
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    font-size: 1rem;
    line-height: 1.6;
    color: #4b5563;
  }

  .benefit-icon {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
    margin-top: 2px;
    color: #111827;
  }

  .benefit-item span {
    flex: 1;
  }

  .benefit-item strong {
    color: #111827;
    font-weight: 600;
  }

  .cta-section {
    background: #f9fafb;
    padding: 1.5rem;
    border-radius: 8px;
    margin-top: 2rem;
    margin-bottom: 5rem;
  }

  .cta-text {
    font-size: 1rem;
    line-height: 1.6;
    color: #4b5563;
    margin: 0;
  }

  .cta-text strong {
    color: #111827;
  }

  .marketing-section.hidden {
    display: none;
  }

  @media (max-width: 640px) {
    .marketing-title {
      font-size: 1.5rem;
    }

    .marketing-description {
      font-size: 1rem;
    }

    .benefits-title {
      font-size: 1.125rem;
    }

    .benefit-item {
      font-size: 0.875rem;
    }
  }
</style>

<script>
  // Listen for file selection events and results to hide marketing section
  document.addEventListener('DOMContentLoaded', () => {
    const marketingSection = document.getElementById('marketing-section');
    const fileList = document.getElementById('file-upload-file-list');
    const loadingContainer = document.getElementById('file-upload-loading');
    const resultsContainer = document.getElementById('results-table');
    
    if (!marketingSection) return;
    
    function updateMarketingVisibility() {
      // Hide marketing if any of these conditions are true:
      // 1. File list is visible with content
      // 2. Loading spinner is visible
      // 3. Results are visible
      const shouldHide = 
        (fileList && !fileList.classList.contains('hidden') && fileList.innerHTML.trim() !== '') ||
        (loadingContainer && !loadingContainer.classList.contains('hidden')) ||
        (resultsContainer && !resultsContainer.classList.contains('hidden'));
      
      if (marketingSection) {
        if (shouldHide) {
          marketingSection.classList.add('hidden');
        } else {
          marketingSection.classList.remove('hidden');
        }
      }
    }
    
    // Create observers for all relevant elements
    const observer = new MutationObserver(updateMarketingVisibility);
    
    // Observe file list
    if (fileList) {
      observer.observe(fileList, {
        attributes: true,
        attributeFilter: ['class'],
        childList: true,
        subtree: true
      });
    }
    
    // Observe loading container
    if (loadingContainer) {
      observer.observe(loadingContainer, {
        attributes: true,
        attributeFilter: ['class']
      });
    }
    
    // Observe results container
    if (resultsContainer) {
      observer.observe(resultsContainer, {
        attributes: true,
        attributeFilter: ['class']
      });
    }
    
    // Also listen for the lab-results event
    window.addEventListener('lab-results', () => {
      marketingSection.classList.add('hidden');
    });
  });
</script>